<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Basketball Scoreboard Pro</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
</head>
<body>
    <div class="app-container">
        <section id="landing-view" class="view">
            <div class="container">
                <header class="landing-header">
                    <div class="basketball-icon">üèÄ</div>
                    <h1 class="main-title">Basketball Scoreboard Pro</h1>
                    <p class="hero-subtitle">Professional game management & real-time scoreboard</p>
                </header>

                <div class="landing-cards">
                    <div class="card landing-card">
                        <div class="card__body">
                            <div class="card-icon">üëÅÔ∏è</div>
                            <h3>Watch Game</h3>
                            <p>Enter a game code to spectate</p>
                            <input id="watchCodeInput" class="form-control" placeholder="Enter 6-digit code" maxlength="6">
                            <div id="codeValidationMessage" class="validation-message hidden"></div>
                            <button id="watchGameBtn" class="btn btn--primary btn--full-width" disabled>Watch Game</button>
                        </div>
                    </div>

                    <div class="card landing-card">
                        <div class="card__body">
                            <div class="card-icon">üéØ</div>
                            <h3>Host Game</h3>
                            <p>Create and manage a new game</p>
                            <input id="hostPasswordInput" type="password" class="form-control" placeholder="Create admin password">
                            <button id="createGameBtn" class="btn btn--primary btn--full-width">Create Game</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="config-view" class="view hidden">
            <div class="container">
                <header class="section-header">
                    <div>
                        <h2>Game Configuration</h2>
                        <p>Set up your game parameters</p>
                    </div>
                    <div class="game-code-display">
                        <span class="status status--info">
                            Game Code: <span id="configGameCode">000000</span>
                        </span>
                        <button id="copyConfigCode" class="btn btn--outline btn--sm">Copy</button>
                    </div>
                </header>

                <div class="config-grid">
                    <div class="card">
                        <div class="card__body">
                            <h3>Game Type</h3>
                            <div class="game-type-selection">
                                <label class="game-type-option">
                                    <input type="radio" name="gameType" value="friendly" checked>
                                    <div class="game-type-card">
                                        <div class="game-type-icon">ü§ù</div>
                                        <h4>Friendly Game</h4>
                                        <p>Quick game without player rosters</p>
                                    </div>
                                </label>
                                <label class="game-type-option">
                                    <input type="radio" name="gameType" value="full">
                                    <div class="game-type-card">
                                        <div class="game-type-icon">üìä</div>
                                        <h4>Full Game with Stats</h4>
                                        <p>Complete game with player statistics</p>
                                    </div>
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card__body">
                            <h3>Game Settings</h3>
                            <div class="form-group">
                                <label class="form-label" for="gameNameInput">Game Name</label>
                                <input id="gameNameInput" class="form-control" placeholder="Championship Final" maxlength="50">
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label" for="periodDurationSelect">Period Duration</label>
                                    <select id="periodDurationSelect" class="form-control">
                                        <option value="8">8 minutes</option>
                                        <option value="10">10 minutes</option>
                                        <option value="12" selected>12 minutes</option>
                                        <option value="15">15 minutes</option>
                                        <option value="20">20 minutes</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="shotClockSelect">Shot Clock</label>
                                    <select id="shotClockSelect" class="form-control">
                                        <option value="0">No Shot Clock</option>
                                        <option value="14">14 seconds</option>
                                        <option value="24" selected>24 seconds</option>
                                        <option value="30">30 seconds</option>
                                        <option value="custom">Custom</option>
                                    </select>
                                </div>
                            </div>
                            <div id="customShotClockGroup" class="form-group hidden">
                                <input id="customShotClock" class="form-control" type="number" min="5" max="60" placeholder="Custom seconds">
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card__body">
                            <h3>Team Configuration</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label" for="teamAName">Team A Name</label>
                                    <input id="teamAName" class="form-control" placeholder="Home Team" maxlength="20">
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="teamAColor">Team A Color</label>
                                    <div class="color-picker-group">
                                        <input id="teamAColor" class="form-control color-input" type="color" value="#FF6B35">
                                        <div class="color-preview" id="teamAColorPreview"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label" for="teamBName">Team B Name</label>
                                    <input id="teamBName" class="form-control" placeholder="Away Team" maxlength="20">
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="teamBColor">Team B Color</label>
                                    <div class="color-picker-group">
                                        <input id="teamBColor" class="form-control color-input" type="color" value="#1B263B">
                                        <div class="color-preview" id="teamBColorPreview"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="section-actions">
                    <button id="backToLandingFromConfig" class="btn btn--outline">‚Üê Back to Landing</button>
                    <button id="proceedToSetup" class="btn btn--primary">Continue</button>
                </div>
            </div>
        </section>

        <section id="setup-view" class="view hidden">
            <div class="container">
                <header class="section-header">
                    <div>
                        <h2>Team Setup</h2>
                        <p>Add players to both teams (min 1 player each for 3v3)</p>
                    </div>
                    <div class="game-code-display">
                        <span class="status status--info">
                            Game Code: <span id="setupGameCode">000000</span>
                        </span>
                        <button id="copySetupCode" class="btn btn--outline btn--sm">Copy</button>
                    </div>
                </header>

                <div class="setup-grid">
                    <div class="card team-setup-card">
                        <div class="card__body">
                            <h3 id="teamASetupTitle">Team A</h3>
                            <div class="player-form">
                                <div class="form-row">
                                    <div class="form-group">
                                        <input id="teamAPlayerNumber" class="form-control" type="number" min="0" max="99" placeholder="Jersey #">
                                    </div>
                                    <div class="form-group">
                                        <input id="teamAPlayerName" class="form-control" placeholder="Player Name" maxlength="30">
                                    </div>
                                    <div class="form-group">
                                        <select id="teamAPlayerPosition" class="form-control">
                                            <option value="">Position</option>
                                            <option value="PG">PG</option>
                                            <option value="SG">SG</option>
                                            <option value="SF">SF</option>
                                            <option value="PF">PF</option>
                                            <option value="C">C</option>
                                        </select>
                                    </div>
                                    <button id="addTeamAPlayer" class="btn btn--primary">Add</button>
                                </div>
                            </div>
                            <div id="teamARoster" class="roster-list"></div>
                            <div class="roster-counter">
                                Players: <span id="teamACount">0</span>/15
                            </div>
                        </div>
                    </div>

                    <div class="card team-setup-card">
                        <div class="card__body">
                            <h3 id="teamBSetupTitle">Team B</h3>
                            <div class="player-form">
                                <div class="form-row">
                                    <div class="form-group">
                                        <input id="teamBPlayerNumber" class="form-control" type="number" min="0" max="99" placeholder="Jersey #">
                                    </div>
                                    <div class="form-group">
                                        <input id="teamBPlayerName" class="form-control" placeholder="Player Name" maxlength="30">
                                    </div>
                                    <div class="form-group">
                                        <select id="teamBPlayerPosition" class="form-control">
                                            <option value="">Position</option>
                                            <option value="PG">PG</option>
                                            <option value="SG">SG</option>
                                            <option value="SF">SF</option>
                                            <option value="PF">PF</option>
                                            <option value="C">C</option>
                                        </select>
                                    </div>
                                    <button id="addTeamBPlayer" class="btn btn--primary">Add</button>
                                </div>
                            </div>
                            <div id="teamBRoster" class="roster-list"></div>
                            <div class="roster-counter">
                                Players: <span id="teamBCount">0</span>/15
                            </div>
                        </div>
                    </div>
                </div>

                <div class="section-actions">
                    <button id="backToConfig" class="btn btn--outline">‚Üê Back to Configuration</button>
                    <button id="skipRosterSetup" class="btn btn--secondary">Skip & Start Game</button>
                    <button id="startGame" class="btn btn--primary" disabled>Start Game</button>
                </div>
            </div>
        </section>

        <section id="control-view" class="view hidden">
            <div class="container-fluid">
                <header class="control-header">
                    <div class="control-title">
                        <h2 id="gameNameDisplay">Basketball Game</h2>
                        <div class="game-code-display">
                            <span class="status status--info">
                                Game Code: <span id="controlGameCode">000000</span>
                            </span>
                            <button id="copyControlCode" class="btn btn--outline btn--sm">Copy</button>
                        </div>
                    </div>
                    <div class="control-actions">
                        <button id="undoBtn" class="btn btn--warning">Undo Last</button> <button id="pauseResumeGame" class="btn btn--secondary">Pause</button>
                        #NEW CHANGE OF UNDO 
                        <button id="pauseResumeGame" class="btn btn--secondary">Pause</button>
                        <button id="exportGame" class="btn btn--outline">Export</button>
                        <button id="resetGame" class="btn btn--outline">Reset</button>
                    </div>
                </header>

                <div class="control-grid">
                    <div class="scoreboard-section">
                        <div class="card">
                            <div class="card__body">
                                <div class="scoreboard">
                                    <div class="team-score" id="teamAScoreSection">
                                        <h3 id="teamAName">Team A</h3>
                                        <div class="score-display" id="teamAScore">0</div>
                                        <div class="top-scorer" id="teamATopScorer">No scorer yet</div>
                                        <div class="score-controls">
                                            <button class="btn btn--sm score-btn" data-team="teamA" data-points="1">+1</button>
                                            <button class="btn btn--sm score-btn" data-team="teamA" data-points="2">+2</button>
                                            <button class="btn btn--sm score-btn" data-team="teamA" data-points="3">+3</button>
                                            <button class="btn btn--sm score-btn" data-team="teamA" data-points="-1">-1</button>
                                        </div>
                                    </div>

                                    <div class="clock-section">
                                        <div class="clock-display game-clock" id="gameClockDisplay" title="Click to edit">12:00</div>
                                        <div class="period-display">Period <span id="periodDisplay">1</span></div>
                                        
                                        <div class="master-clock-controls">
                                            <button id="startGameBtn" class="btn btn--primary master-start-btn">START GAME</button>
                                            <div class="clock-control-row">
                                                <button id="resetAllBtn" class="btn btn--outline btn--sm">Reset All</button>
                                                <button id="editGameClock" class="btn btn--secondary btn--sm">Edit Time</button>
                                                <button id="nextPeriod" class="btn btn--secondary btn--sm">Next Period</button>
                                            </div>
                                        </div>
                                        
                                        <div class="shot-clock-section" id="shotClockSection">
                                            <div class="shot-clock-display" id="shotClockDisplay" title="Click to edit">24</div>
                                            <div class="shot-clock-label">Shot Clock</div>
                                            <div class="shot-clock-actions">
                                                <button id="resetShotClock14" class="btn btn--warning btn--sm">14s</button>
                                                <button id="resetShotClock24" class="btn btn--warning btn--sm">24s</button>
                                                <button id="editShotClock" class="btn btn--secondary btn--sm">Edit</button>
                                                <button id="startShotClock" class="btn btn--success btn--sm">Start</button>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="team-score" id="teamBScoreSection">
                                        <h3 id="teamBName">Team B</h3>
                                        <div class="score-display" id="teamBScore">0</div>
                                        <div class="top-scorer" id="teamBTopScorer">No scorer yet</div>
                                        <div class="score-controls">
                                            <button class="btn btn--sm score-btn" data-team="teamB" data-points="1">+1</button>
                                            <button class="btn btn--sm score-btn" data-team="teamB" data-points="2">+2</button>
                                            <button class="btn btn--sm score-btn" data-team="teamB" data-points="3">+3</button>
                                            <button class="btn btn--sm score-btn" data-team="teamB" data-points="-1">-1</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="game-info-grid">
                            <div class="card">
                                <div class="card__body">
                                    <h4>Team A Info</h4>
                                    <div class="team-info">
                                        <div class="info-item">
                                            <span>Timeouts:</span>
                                            <div class="counter-controls">
                                                <button class="btn btn--sm" data-action="timeout-minus" data-team="teamA">-</button>
                                                <span id="teamATimeouts">7</span>
                                                <button class="btn btn--sm" data-action="timeout-plus" data-team="teamA">+</button>
                                            </div>
                                        </div>
                                        <div class="info-item">
                                            <span>Team Fouls:</span>
                                            <div class="counter-controls">
                                                <button class="btn btn--sm" data-action="foul-minus" data-team="teamA">-</button>
                                                <span id="teamAFouls">0</span>
                                                <button class="btn btn--sm" data-action="foul-plus" data-team="teamA">+</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="card">
                                <div class="card__body">
                                    <h4>Possession</h4>
                                    <div class="possession-controls">
                                        <button id="possessionTeamA" class="btn btn--outline possession-btn active">Team A</button>
                                        <button id="possessionTeamB" class="btn btn--outline possession-btn">Team B</button>
                                    </div>
                                </div>
                            </div>

                            <div class="card">
                                <div class="card__body">
                                    <h4>Team B Info</h4>
                                    <div class="team-info">
                                        <div class="info-item">
                                            <span>Timeouts:</span>
                                            <div class="counter-controls">
                                                <button class="btn btn--sm" data-action="timeout-minus" data-team="teamB">-</button>
                                                <span id="teamBTimeouts">7</span>
                                                <button class="btn btn--sm" data-action="timeout-plus" data-team="teamB">+</button>
                                            </div>
                                        </div>
                                        <div class="info-item">
                                            <span>Team Fouls:</span>
                                            <div class="counter-controls">
                                                <button class="btn btn--sm" data-action="foul-minus" data-team="teamB">-</button>
                                                <span id="teamBFouls">0</span>
                                                <button class="btn btn--sm" data-action="foul-plus" data-team="teamB">+</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="stats-section" id="statsSection">
                        <div class="card">
                            <div class="card__body">
                                <div class="stats-header">
                                    <h4>Comprehensive Player Statistics</h4>
                                    <div class="stats-controls">
                                        <select id="statTeamSelect" class="form-control">
                                            <option value="teamA">Team A</option>
                                            <option value="teamB">Team B</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="player-scoring-grid" id="playerScoringGrid">
                                    </div>
                                
                                <div class="comprehensive-stats-section">
                                    <h5>Full Statistics Table</h5>
                                    <div class="stats-table-container">
                                        <table class="comprehensive-stats-table">
                                            <thead>
                                                <tr>
                                                    <th class="sticky-col">#</th>
                                                    <th class="sticky-col">Name</th>
                                                    <th>PTS</th>
                                                    <th>FT</th>
                                                    <th>2PT</th>
                                                    <th>3PT</th>
                                                    <th>ORB</th>
                                                    <th>DRB</th>
                                                    <th>REB</th>
                                                    <th>AST</th>
                                                    <th>STL</th>
                                                    <th>BLK</th>
                                                    <th>TO</th>
                                                    <th>PF</th>
                                                    <th>MIN</th>
                                                </tr>
                                            </thead>
                                            <tbody id="comprehensiveStatsTableBody">
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                
                                <div class="quick-stats-actions">
                                    <h5>Quick Stat Entry</h5>
                                    <div class="quick-stat-grid">
                                        <select id="quickStatPlayer" class="form-control">
                                            <option value="">Select Player</option>
                                        </select>
                                        <div class="stat-buttons">
                                            <button class="btn btn--sm stat-btn" data-stat="offensiveRebounds">+ORB</button>
                                            <button class="btn btn--sm stat-btn" data-stat="defensiveRebounds">+DRB</button>
                                            <button class="btn btn--sm stat-btn" data-stat="assists">+AST</button>
                                            <button class="btn btn--sm stat-btn" data-stat="steals">+STL</button>
                                            <button class="btn btn--sm stat-btn" data-stat="blocks">+BLK</button>
                                            <button class="btn btn--sm stat-btn" data-stat="turnovers">+TO</button>
                                            <button class="btn btn--sm stat-btn" data-stat="fouls">+PF</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="viewer-view" class="view hidden">
            <div class="container-fluid">
                <div class="viewer-scoreboard">
                    <div class="viewer-team" id="viewerTeamA">
                        <h2 id="viewerTeamAName">Team A</h2>
                        <div class="viewer-score" id="viewerTeamAScore">0</div>
                        <div class="viewer-top-scorer" id="viewerTeamATopScorer">No scorer yet</div>
                    </div>
                    
                    <div class="viewer-center">
                        <div class="viewer-clock" id="viewerGameClock">12:00</div>
                        <div class="viewer-period">Period <span id="viewerPeriod">1</span></div>
                        <div class="viewer-shot-clock" id="viewerShotClock" style="display: none;">24</div>
                    </div>
                    
                    <div class="viewer-team" id="viewerTeamB">
                        <h2 id="viewerTeamBName">Team B</h2>
                        <div class="viewer-score" id="viewerTeamBScore">0</div>
                        <div class="viewer-top-scorer" id="viewerTeamBTopScorer">No scorer yet</div>
                    </div>
                </div>
                
                <div class="viewer-info">
                    <div class="game-name" id="viewerGameName">Basketball Game</div>
                    <div class="possession-indicator">
                        <span>Possession:</span>
                        <span id="viewerPossession">Team A</span>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <div id="toastContainer" class="toast-container"></div>

    <div id="shotClockViolation" class="violation-alert hidden">
        <div class="violation-content">
            <div class="violation-icon">‚è∞</div>
            <div class="violation-text">SHOT CLOCK VIOLATION</div>
        </div>
    </div>

    <div id="editClockModal" class="modal hidden">
        <div class="modal-content">
            <h3>Edit Game Clock</h3>
            <div class="form-group">
                <label for="editMinutes">Minutes:</label>
                <input id="editMinutes" type="number" min="0" max="99" class="form-control">
            </div>
            <div class="form-group">
                <label for="editSeconds">Seconds:</label>
                <input id="editSeconds" type="number" min="0" max="59" class="form-control">
            </div>
            <div class="modal-actions">
                <button id="cancelClockEdit" class="btn btn--outline">Cancel</button>
                <button id="saveClockEdit" class="btn btn--primary">Save</button>
            </div>
        </div>
    </div>

    <div id="editShotClockModal" class="modal hidden">
        <div class="modal-content">
            <h3>Edit Shot Clock</h3>
            <div class="form-group">
                <label for="editShotClockSeconds">Seconds:</label>
                <input id="editShotClockSeconds" type="number" min="0" max="60" class="form-control">
            </div>
            <div class="modal-actions">
                <button id="cancelShotClockEdit" class="btn btn--outline">Cancel</button>
                <button id="saveShotClockEdit" class="btn btn--primary">Save</button>
            </div>
        </div>
    </div>

    <audio id="buzzerSound" preload="auto">
        <source src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmcfBjiS2OzNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmcfBjiS2OzNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmcfBjiS2OzNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmcfBjiS2OzNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmcfBjiS2OzNeSsFA=" type="audio/wav">
    </audio>

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

    <script>
      // Initialize Firebase
      // YOUR KEYS ARE ALREADY PASTED IN HERE
      const firebaseConfig = {
        apiKey: "AIzaSyACfaiaL8JWyKCQzdZbfakm-2nHU0",
        authDomain: "bmsce-box.firebaseapp.com",
        projectId: "bmsce-box",
        storageBucket: "bmsce-box.appspot.com",
        messagingSenderId: "385203527779",
        appId: "1:385203527779:web:96f052742085c4f53337e",
        measurementId: "G-FDCJSH8QDY"
      };

      let db;
      try {
        firebase.initializeApp(firebaseConfig);
        db = firebase.firestore();
        console.log("Firebase initialized successfully");
      } catch (e) {
        console.error("Firebase initialization failed:", e);
        alert("Could not connect to the database. Please check your Firebase config.");
      }
    </script>
    <script src="app.js"></script>
</body>
</html>